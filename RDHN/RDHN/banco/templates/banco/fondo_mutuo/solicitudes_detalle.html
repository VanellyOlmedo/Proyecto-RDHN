{% extends 'core/base.html' %}

{% block title %}Detalle Solicitud - Fondo Mutuo{% endblock %}

{% block content %}
<div class="content-header">
    <h1 class="content-title">üìã Detalle de Solicitud: {{ solicitud.numero_solicitud }}</h1>
    <div class="breadcrumb">
        <span class="breadcrumb-item"><a href="{% url 'fondo_mutuo:solicitudes_listar' %}">Solicitudes</a></span>
        <span class="breadcrumb-item">{{ solicitud.numero_solicitud }}</span>
    </div>
</div>

<div class="grid grid-2" style="align-items: start;">
    <!-- Informaci√≥n Principal -->
    <div>
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">üìÑ Informaci√≥n de la Solicitud</h2>
                <div>
                    {% if solicitud.estado == 'PENDIENTE' %}
                        <span class="badge badge-warning">{{ solicitud.get_estado_display }}</span>
                    {% elif solicitud.estado == 'EN_REVISION' %}
                        <span class="badge badge-info">{{ solicitud.get_estado_display }}</span>
                    {% elif solicitud.estado == 'APROBADA' %}
                        <span class="badge badge-success">{{ solicitud.get_estado_display }}</span>
                    {% elif solicitud.estado == 'RECHAZADA' %}
                        <span class="badge badge-error">{{ solicitud.get_estado_display }}</span>
                    {% elif solicitud.estado == 'DESEMBOLSADA' %}
                        <span class="badge badge-primary">{{ solicitud.get_estado_display }}</span>
                    {% else %}
                        <span class="badge">{{ solicitud.get_estado_display }}</span>
                    {% endif %}
                </div>
            </div>
            
            <div class="card-body">
                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div>
                        <strong style="color: var(--color-text-dim); font-size: 12px;">N√öMERO DE SOLICITUD</strong>
                        <p style="font-size: 24px; margin-top: 5px; color: var(--color-secondary); font-weight: bold;">
                            {{ solicitud.numero_solicitud }}
                        </p>
                    </div>
                    
                    <div class="grid grid-2">
                        <div>
                            <strong style="color: var(--color-text-dim); font-size: 12px;">FECHA DE SOLICITUD</strong>
                            <p style="font-size: 16px; margin-top: 5px;">
                                {{ solicitud.fecha_solicitud|date:"d/m/Y" }}
                            </p>
                        </div>
                        <div>
                            <strong style="color: var(--color-text-dim); font-size: 12px;">PER√çODO</strong>
                            <p style="font-size: 16px; margin-top: 5px;">
                                {{ solicitud.fondo }}
                            </p>
                        </div>
                    </div>
                    
                    <div>
                        <strong style="color: var(--color-text-dim); font-size: 12px;">SOCIO SOLICITANTE</strong>
                        <p style="font-size: 18px; margin-top: 5px;">
                            {{ solicitud.socio.nombre_completo }}
                        </p>
                        <p style="font-size: 14px; color: var(--color-text-dim); margin-top: 3px;">
                            No. Socio: {{ solicitud.socio.numero_socio }}
                        </p>
                    </div>
                    
                    <div>
                        <strong style="color: var(--color-text-dim); font-size: 12px;">TIPO DE AYUDA</strong>
                        <p style="font-size: 16px; margin-top: 5px;">
                            <span class="badge badge-info">{{ solicitud.get_tipo_ayuda_display }}</span>
                        </p>
                    </div>
                    
                    <div>
                        <strong style="color: var(--color-text-dim); font-size: 12px;">JUSTIFICACI√ìN</strong>
                        <p style="font-size: 14px; margin-top: 5px; line-height: 1.8; text-align: justify;">
                            {{ solicitud.justificacion }}
                        </p>
                    </div>
                    
                    {% if solicitud.documento_soporte %}
                    <div>
                        <strong style="color: var(--color-text-dim); font-size: 12px;">DOCUMENTO DE SOPORTE</strong>
                        <p style="margin-top: 10px;">
                            <a href="{{ solicitud.documento_soporte.url }}" target="_blank" class="btn btn-sm btn-primary">
                                üìé Descargar Documento
                            </a>
                        </p>
                    </div>
                    {% endif %}
                    
                    {% if solicitud.creado_por %}
                    <div>
                        <strong style="color: var(--color-text-dim); font-size: 12px;">CREADO POR</strong>
                        <p style="font-size: 14px; margin-top: 5px;">
                            {{ solicitud.creado_por.get_full_name|default:solicitud.creado_por.usuario }}
                        </p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Informaci√≥n de Revisi√≥n -->
        {% if solicitud.estado != 'PENDIENTE' %}
        <div class="card" style="margin-top: 20px;">
            <div class="card-header">
                <h2 class="card-title">üîç Informaci√≥n de Revisi√≥n</h2>
            </div>
            <div class="card-body">
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    {% if solicitud.fecha_revision %}
                    <div>
                        <strong style="color: var(--color-text-dim); font-size: 12px;">FECHA DE REVISI√ìN</strong>
                        <p style="font-size: 16px; margin-top: 5px;">
                            {{ solicitud.fecha_revision|date:"d/m/Y" }}
                        </p>
                    </div>
                    {% endif %}
                    
                    {% if solicitud.revisado_por %}
                    <div>
                        <strong style="color: var(--color-text-dim); font-size: 12px;">REVISADO POR</strong>
                        <p style="font-size: 16px; margin-top: 5px;">
                            {{ solicitud.revisado_por.get_full_name|default:solicitud.revisado_por.usuario }}
                        </p>
                    </div>
                    {% endif %}
                    
                    {% if solicitud.comentarios_revision %}
                    <div>
                        <strong style="color: var(--color-text-dim); font-size: 12px;">COMENTARIOS</strong>
                        <p style="font-size: 14px; margin-top: 5px; line-height: 1.6;">
                            {{ solicitud.comentarios_revision }}
                        </p>
                    </div>
                    {% endif %}
                    
                    {% if solicitud.motivo_rechazo %}
                    <div class="alert alert-error">
                        <span>‚úï</span>
                        <div>
                            <strong>Motivo del Rechazo:</strong>
                            <p style="margin-top: 5px;">{{ solicitud.motivo_rechazo }}</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Informaci√≥n Financiera -->
    <div>
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">üí∞ Informaci√≥n Financiera</h2>
            </div>
            <div class="card-body">
                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div style="text-align: center; padding: 20px; background: rgba(69, 162, 158, 0.1); border-radius: var(--radius-md);">
                        <strong style="color: var(--color-text-dim); font-size: 14px;">MONTO SOLICITADO</strong>
                        <p style="font-size: 42px; margin-top: 10px; font-weight: bold; color: var(--color-secondary);">
                            L. {{ solicitud.monto_solicitado|floatformat:2 }}
                        </p>
                    </div>
                    
                    {% if solicitud.monto_aprobado %}
                    <div style="text-align: center; padding: 20px; background: rgba(76, 175, 80, 0.1); border-radius: var(--radius-md);">
                        <strong style="color: var(--color-text-dim); font-size: 14px;">MONTO APROBADO</strong>
                        <p style="font-size: 42px; margin-top: 10px; font-weight: bold; color: var(--color-success);">
                            L. {{ solicitud.monto_aprobado|floatformat:2 }}
                        </p>
                    </div>
                    {% endif %}
                    
                    <div style="padding: 15px; background: rgba(69, 162, 158, 0.05); border-radius: var(--radius-md);">
                        <strong style="color: var(--color-text-dim); font-size: 12px;">SALDO DISPONIBLE EN FONDO</strong>
                        <p style="font-size: 20px; margin-top: 5px; font-weight: bold; color: var(--color-primary);">
                            L. {{ solicitud.fondo.saldo_disponible|floatformat:2 }}
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Movimientos Relacionados -->
        {% if movimientos %}
        <div class="card" style="margin-top: 20px;">
            <div class="card-header">
                <h2 class="card-title">üí∏ Movimientos Relacionados</h2>
            </div>
            <div class="card-body">
                {% for mov in movimientos %}
                <div class="padding: 15px; background: rgba(69, 162, 158, 0.05); border-radius: var(--radius-md); {% if not forloop.last %}margin-bottom: 15px;{% endif %}">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <strong>{{ mov.numero_movimiento }}</strong>
                        <span class="badge badge-error">{{ mov.get_origen_display }}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: var(--color-text-dim);">{{ mov.fecha_movimiento|date:"d/m/Y H:i" }}</span>
                        <span style="font-size: 20px; font-weight: bold; color: var(--color-error);">
                            L. {{ mov.monto|floatformat:2 }}
                        </span>
                    </div>
                    <a href="{% url 'fondo_mutuo:movimientos_detalle' mov.pk %}" class="btn btn-sm" style="margin-top: 10px; width: 100%;">
                        Ver Comprobante
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Botones de Acci√≥n -->
<div style="display: flex; gap: 10px; margin-top: 30px; justify-content: center;">
    {% if solicitud.estado == 'PENDIENTE' or solicitud.estado == 'EN_REVISION' %}
    <a href="{% url 'fondo_mutuo:solicitudes_aprobar' solicitud.pk %}" class="btn btn-success">
        <span>‚úì</span> Aprobar Solicitud
    </a>
    <a href="{% url 'fondo_mutuo:solicitudes_rechazar' solicitud.pk %}" class="btn btn-error">
        <span>‚úï</span> Rechazar Solicitud
    </a>
    {% endif %}
    <a href="{% url 'fondo_mutuo:solicitudes_listar' %}" class="btn">
        <span>‚óÄÔ∏è</span> Volver al Listado
    </a>
</div>
{% endblock %}